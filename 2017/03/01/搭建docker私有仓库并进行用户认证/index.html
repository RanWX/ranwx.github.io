<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 搭建docker私有仓库并进行用户认证 | Rosy's</title><meta name="description" content="搭建docker私有仓库并进行用户认证 - Rosy"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/casual.css"><link rel="stylesheet" href="/css/semantic.min.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Rosy's"></head><body><div class="sidebar"><div class="ui vertical inverted menu"><div class="h100"></div><h3 class="ui inverted aligned icon header"><div class="content"><a href="/" class="title-link">ROSY'S</a></div></h3><div class="h50"></div><div class="side-nav"><a href="/" target="_self" class="item">HOME<i class="icon home"></i></a><a href="/archives" target="_self" class="item">ARCHIVE<i class="icon archive"></i></a><a href="/tags" target="_self" class="item">TAGS<i class="icon tags"></i></a><a href="/about" target="_self" class="item">INFO<i class="icon info"></i></a><a href="/atom.xml" target="_self" class="item">RSS<i class="icon rss"></i></a></div><div class="item"><div class="ui inverted transparent icon input"><input type="text" placeholder="Search..." class="st-default-search-input"><i class="search icon"></i></div></div><div class="h50"></div></div><div class="h50 mq"><a class="ui teal big label"><i class="content icon"></i></a></div><div class="author-info"><a href="/" class="img-link"><img src="/me.jpeg" class="author-photo ui tiny circular image"></a><h4 class="ui aligned icon header"><div class="content">Rosy</div></h4><p class="author-desc">常常将自己分裂成三个人用于玩斗地主的双子女 | 热衷于烹饪 | 喜欢刘亦菲</p><div class="social-outer"><div class="social-inner"><a href="http://github.com/RanWX" target="_blank" class="social-link"><i class="icon github"></i></a><a href="http://weibo.com/u/2176147782?refer_flag=1005055010_&amp;is_all=1" target="_blank" class="social-link"><i class="icon weibo"></i></a></div></div></div></div><div class="main"><div class="wrap"><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">搭建docker私有仓库并进行用户认证</h1><div class="post-info"><div class="post-date"><h6 class="ui header"><i class="calendar icon"></i><div class="content">Mar 1, 2017</div></h6></div></div><div class="post-content"><p>自定义的镜像可以通过公有仓库进行管理，也可以搭建一个本地的私有仓库进行管理。</p>
<h2 id="1-运行环境"><a href="#1-运行环境" class="headerlink" title="1.运行环境"></a>1.运行环境</h2><blockquote>
<ul>
<li>OS:centos7</li>
<li>docker-reistry1.0 下载<a href="http://7ycyh7.com1.z1.glb.clouddn.com/registry.tar" target="_blank" rel="external">registry.tar</a></li>
<li>nginx1.10.2</li>
<li>docker1.8.2</li>
</ul>
</blockquote>
<h2 id="2-使用docker-registry搭建私有仓库"><a href="#2-使用docker-registry搭建私有仓库" class="headerlink" title="2.使用docker-registry搭建私有仓库"></a>2.使用docker-registry搭建私有仓库</h2><p>将registry.tar上传到安装了docker的centos7中，导入nginx镜像。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker load &lt; registry.tar</div><div class="line">[root@registry ~]# docker images</div><div class="line">REPOSITORY           TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</div><div class="line">docker.io/registry   latest              07d93e41c370        13 months ago       422.8 MB</div></pre></td></tr></table></figure></p>
<p>修改所有计算节点的的hosts配置文件，并刷新hostname。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# vi /etc/hosts</div><div class="line">192.168.147.130  registry</div><div class="line">192.168.147.130  registry_private</div><div class="line">[root@localhost ~]# hostname -F /etc/hostname(刷新hostname)</div></pre></td></tr></table></figure></p>
<p>在docker配置文件中添加允许连接镜像仓库：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# vi /etc/sysconfig/docker</div><div class="line">OPTIONS=&apos;--insecure-registry registry:5000 --insecure-registry registry_private:5001</div></pre></td></tr></table></figure></p>
<p>重启docker：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# service docker restart</div></pre></td></tr></table></figure></p>
<p>运行镜像仓库：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker run -d -p 5000:5000 --name=registry --restart=always --privileged=true  --log-driver=none -v /home/data/registrydata:/tmp/registry registry</div><div class="line">03859903eb0322eaa7b29a915737bb22b685c466d020da499d491485c1f67307</div><div class="line">[root@registry ~]# docker ps -a</div><div class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                    NAMES</div><div class="line">03859903eb03        registry            &quot;docker-registry&quot;   About an hour ago   Up 45 minutes       0.0.0.0:5000-&gt;5000/tcp   registry</div></pre></td></tr></table></figure></p>
<p>上传镜像到仓库：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker tag sshd:centos  registry:5000/sshd:centos</div><div class="line">[root@localhost ~]# docker push registry:5000/sshd:centos</div><div class="line">The push refers to a repository [registry:5000/sshd] (len: 1)</div><div class="line">Sending image list</div><div class="line">Pushing repository registry:5000/sshd (1 tags)</div><div class="line">9509659cbefb: Image successfully pushed </div><div class="line">f0efe62f33e4: Image successfully pushed </div><div class="line">Pushing tag for rev [f0efe62f33e4] on &#123;http://registry:5000/v1/repositories/sshd/tags/centos&#125;</div><div class="line">[root@localhost ~]# curl registry:5000/v1/search</div><div class="line">&#123;&quot;num_results&quot;: 1, &quot;query&quot;: &quot;&quot;, &quot;results&quot;: [&#123;&quot;description&quot;: &quot;&quot;, &quot;name&quot;: &quot;library/sshd&quot;&#125;]&#125;</div></pre></td></tr></table></figure></p>
<p>下载镜像到本地：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@registry ~]# docker pull registry:5000/sshd:centos</div><div class="line">f0efe62f33e4: Download complete </div><div class="line">9509659cbefb: Download complete </div><div class="line">Status: Image is up to date for registry:5000/sshd:centos</div></pre></td></tr></table></figure></p>
<h2 id="3-为私有仓库添加用户认证"><a href="#3-为私有仓库添加用户认证" class="headerlink" title="3.为私有仓库添加用户认证"></a>3.为私有仓库添加用户认证</h2><p>registry没有安全权限的设置，除非防火墙限制，否则任何人都可以pull、push镜像到registry。更安全的做法是在外层加入登录认证机制。可以使用nginx做反向代理，为私有仓库添加用户认证。</p>
<h3 id="3-1安装及配置nginx"><a href="#3-1安装及配置nginx" class="headerlink" title="3.1安装及配置nginx"></a>3.1安装及配置nginx</h3><p>安装nginx<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@registry ~]# yum install nginx</div></pre></td></tr></table></figure></p>
<p>安装htpasswd工具，生成加密后的密码，并将用户名和密码存储在本地指定路径的文件中。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@registry ~]# git clone git://github.com/http-auth/htpasswd.git</div><div class="line">[root@registry ~]# npm install -g htpasswd</div><div class="line">[root@registry ~]# npm install -g htpasswd</div><div class="line">[root@registry ~]# htpasswd -c /etc/nginx/docker-registry.htpasswd usr1</div><div class="line">New password: </div><div class="line">Re-type new password: </div><div class="line">Adding password for user usr1.</div></pre></td></tr></table></figure></p>
<p>配置nginx：在/etc/nginx/sites-enabled/目录下添加新的站点配置文件docker-registry：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">[root@registry nginx]# mkdir /etc/nginx/sites-enabled/</div><div class="line">[root@registry nginx]# vi /etc/nginx/sites-enabled/docker-registry</div><div class="line">upstream docker-registry &#123;</div><div class="line"> server localhost:5000;</div><div class="line">&#125;</div><div class="line">server &#123;</div><div class="line"> listen 5001;</div><div class="line"> server_name registry_private;</div><div class="line"> proxy_set_header Host       $http_host;   # required for Docker client sake</div><div class="line"> proxy_set_header X-Real-IP  $remote_addr; # pass on real client IP</div><div class="line"> client_max_body_size 0; # disable any limits to avoid HTTP 413 for large image uploads</div><div class="line"> # required to avoid HTTP 411: see Issue #1486 (https://github.com/dotcloud/docker/issues/1486)</div><div class="line"> chunked_transfer_encoding on;</div><div class="line"> location / &#123;</div><div class="line">     # let Nginx know about our auth file</div><div class="line">     auth_basic              &quot;Restricted&quot;;</div><div class="line">     auth_basic_user_file    docker-registry.htpasswd;</div><div class="line">     proxy_pass http://docker-registry;</div><div class="line"> &#125;</div><div class="line"> location /_ping &#123;</div><div class="line">     auth_basic off;</div><div class="line">     proxy_pass http://docker-registry;</div><div class="line"> &#125;</div><div class="line"> location /v1/_ping &#123;</div><div class="line">     auth_basic off;</div><div class="line">     proxy_pass http://docker-registry;</div><div class="line"> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>建立配置文件软连接，放在/etc/nginx/conf.d/下，让nginx启用它，然后重启nginx服务：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@registry sites-enabled]# sudo ln -s /etc/nginx/sites-enabled/docker-registry /etc/nginx/conf.d/docker-registry.conf</div><div class="line">[root@registry sites-enabled]# service nginx restart</div></pre></td></tr></table></figure></p>
<p>如果这一步遇到这个问题：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@registry sites-enabled]# systemctl status nginx.service</div><div class="line">nginx.service - The nginx HTTP and reverse proxy server</div><div class="line">   Loaded: loaded (/usr/lib/systemd/system/nginx.service; disabled)</div><div class="line">   Active: failed (Result: exit-code) since Thu 2017-03-02 11:08:27 CST; 14s ago</div><div class="line">  Process: 39831 ExecStartPre=/usr/sbin/nginx -t (code=exited, status=1/FAILURE)</div><div class="line">  Process: 39830 ExecStartPre=/usr/bin/rm -f /run/nginx.pid (code=exited, status=0/SUCCESS)</div><div class="line">Mar 02 11:08:27 registry systemd[1]: Starting The nginx HTTP and reverse proxy server...</div><div class="line">Mar 02 11:08:27 registry nginx[39831]: nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</div><div class="line">**Mar 02 11:08:27 registry nginx[39831]: nginx: [emerg] bind() to 0.0.0.0:5001 failed (13: Permission denied)**</div><div class="line">Mar 02 11:08:27 registry nginx[39831]: nginx: configuration file /etc/nginx/nginx.conf test failed</div><div class="line">Mar 02 11:08:27 registry systemd[1]: nginx.service: control process exited, code=exited status=1</div><div class="line">Mar 02 11:08:27 registry systemd[1]: Failed to start The nginx HTTP and reverse proxy server.</div><div class="line">Mar 02 11:08:27 registry systemd[1]: Unit nginx.service entered failed state.</div></pre></td></tr></table></figure></p>
<p>可能是是开启了selinux导致的，查看是否开启了selinux，”Enforecing”代表开启了selinux，”disabled”或者”permissive”则是关闭了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@registry sites-enabled]# getenforce</div><div class="line">Enforcing</div><div class="line">[root@registry sites-enabled]# setenforce 0 (临时关闭selinux)</div><div class="line">[root@registry sites-enabled]# getenforce</div><div class="line">Permissive</div></pre></td></tr></table></figure></p>
<p>这时访问registry_private:5001，则被禁止：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@registry sites-enabled]# getenforce</div><div class="line">Permissive</div></pre></td></tr></table></figure></p>
<p>临时修改重启电脑后再重启nginx，每次均需要修改，可以永久关闭，修改/etc/selinux/config 文件，将SELINUX=enforcing改为SELINUX=disabled，重启电脑生效。<br>通过用户名和密码登录：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@registry sites-enabled]# curl usr1:123456@registry_private:5001/v1/search</div><div class="line">&#123;&quot;num_results&quot;: 1, &quot;query&quot;: &quot;&quot;, &quot;results&quot;: [&#123;&quot;description&quot;: &quot;&quot;, &quot;name&quot;: &quot;library/sshd&quot;&#125;]&#125;</div></pre></td></tr></table></figure></p>
<p>如果用浏览器登录，则会出现要求填写用户名和密码的对话框。</p>
<h3 id="3-2为nginx安装ssl证书"><a href="#3-2为nginx安装ssl证书" class="headerlink" title="3.2为nginx安装ssl证书"></a>3.2为nginx安装ssl证书</h3><p>此时登录registry_private下载镜像，会无法下载：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@registry sites-enabled]# docker login registry_private:5001</div><div class="line">Username: usr1</div><div class="line">Password: </div><div class="line">Email: </div><div class="line">WARNING: login credentials saved in /root/.docker/config.json</div><div class="line">Login Succeeded</div><div class="line">[root@registry sites-enabled]# docker pull registry_private:5001/sshd:centos</div><div class="line">Trying to pull repository registry_private:5001/sshd ... failed</div><div class="line">Could not reach any registry endpoint</div></pre></td></tr></table></figure></p>
<p>这是因为docker-registry不允许http明文传输，此时可以安装SSL证书，使用HTTPS传输。<br>首先在nginx配置文件中添加：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@registry sites-enabled]#  vi /etc/nginx/conf.d/docker-registry.conf</div><div class="line">......</div><div class="line">server &#123;</div><div class="line"> listen 5001;</div><div class="line"> server_name registry_private;</div><div class="line"> ssl on;</div><div class="line"> ssl_certificate /etc/nginx/ssl/nginx.crt;</div><div class="line"> ssl_certificate_key /etc/nginx/ssl/nginx.key;</div><div class="line">......</div></pre></td></tr></table></figure></p>
<p>创建相关证书：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[root@registry sites-enabled]# mkdir /etc/nginx/ssl  (创建配置目录)</div><div class="line">[root@registry sites-enabled]# cd /etc/pki/CA</div><div class="line">[root@registry CA]# openssl genrsa -out private/cakey.pem 2048  (生成秘钥)</div><div class="line">[root@registry CA]# cd /etc/pki/CA/private/</div><div class="line">y.pem</div><div class="line">[root@registry private]# chmod 400 cakey.pem (修改私钥文件权限)[root@registry private]# cd /etc/pki/CA/</div><div class="line">[root@registry CA]# openssl req -new -x509 -key private/cakey.pem -out cacert.pem  (生成根证书)</div><div class="line">You are about to be asked to enter information that will be incorporated</div><div class="line">into your certificate request.</div><div class="line">What you are about to enter is what is called a Distinguished Name or a DN.</div><div class="line">There are quite a few fields but you can leave some blank</div><div class="line">For some fields there will be a default value,</div><div class="line">If you enter &apos;.&apos;, the field will be left blank.</div><div class="line">-----</div><div class="line">Country Name (2 letter code) [XX]:CN</div><div class="line">State or Province Name (full name) []:BJ</div><div class="line">Locality Name (eg, city) [Default City]:BJ</div><div class="line">Organization Name (eg, company) [Default Company Ltd]:  </div><div class="line">Organizational Unit Name (eg, section) []:</div><div class="line">Common Name (eg, your name or your server&apos;s hostname) []:</div><div class="line">Email Address []:</div></pre></td></tr></table></figure></p>
<p>生成根证书的时候会提示输入一些内容，可以随便输入，也可直接回车。如果有入，最好与后续为nginx生成证书签署请求的填写内容保持一致。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">[root@registry private]# cd /etc/pki/CA/</div><div class="line">[root@registry CA]# openssl req -new -x509 -key private/cakey.pem -out cacert.pem  (生成根证书)</div><div class="line">[root@registry CA]# cd /etc/nginx/ssl</div><div class="line">[root@registry ssl]# openssl genrsa -out nginx.key 2048  (为nginx web服务器生成ssl密钥)</div><div class="line">[root@registry ssl]# openssl req -new -key nginx.key -out nginx.csr  (为nginx生成证书请求)</div><div class="line">You are about to be asked to enter information that will be incorporated</div><div class="line">into your certificate request.</div><div class="line">What you are about to enter is what is called a Distinguished Name or a DN.</div><div class="line">There are quite a few fields but you can leave some blank</div><div class="line">For some fields there will be a default value,</div><div class="line">If you enter &apos;.&apos;, the field will be left blank.</div><div class="line">-----</div><div class="line">Country Name (2 letter code) [XX]:CN</div><div class="line">State or Province Name (full name) []:BJ</div><div class="line">Locality Name (eg, city) [Default City]:BJ</div><div class="line">Organization Name (eg, company) [Default Company Ltd]:</div><div class="line">Organizational Unit Name (eg, section) []:</div><div class="line">Common Name (eg, your name or your server&apos;s hostname) []:regstry_private(**此处一定要填写需要授予证书的服务器域名或主机名**)</div><div class="line">Email Address []:</div><div class="line">Please enter the following &apos;extra&apos; attributes</div><div class="line">to be sent with your certificate request</div><div class="line">A challenge password []:</div><div class="line">An optional company name []:</div><div class="line">[root@registry ssl]# touch /etc/pki/CA/index.txt</div><div class="line">[root@registry ssl]# touch /etc/pki/CA/serial</div><div class="line">[root@registry ssl]# echo &quot;00&quot; &gt; /etc/pki/CA/serial</div><div class="line">[root@registry ssl]# openssl ca -in nginx.csr -out nginx.crt  (私有CA根据请求来签发证书)</div><div class="line">Using configuration from /etc/pki/tls/openssl.cnf</div><div class="line">Check that the request matches the signature</div><div class="line">Signature ok</div><div class="line">The commonName field needed to be supplied and was missing (生成证书请求是没有填写任何信息,所以有这一句话的提示。)</div></pre></td></tr></table></figure></p>
<p>让根证书起作用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@registry ssl]# cp /etc/pki/tls/certs/ca-bundle.crt&#123;,.bak&#125;  (备份，以防出错)</div><div class="line">[root@registry ssl]# cat /etc/pki/CA/cacert.pem &gt;&gt; /etc/pki/tls/certs/ca-bundle.crt</div></pre></td></tr></table></figure></p>
<p>此时再下载私有仓库的镜像：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@registry certs]# docker pull registry_private:5001/sshd:centos</div><div class="line">f0efe62f33e4: Download complete </div><div class="line">9509659cbefb: Download complete </div><div class="line">Status: Image is up to date for registry_private:5001/sshd:centos</div></pre></td></tr></table></figure></p>
<p>用网页登录时，需要注意是https协议。<br><img src="http://7ycyh7.com1.z1.glb.clouddn.com/屏幕快照%202017-03-02%20下午2.10.31.png" alt="网页登录"></p>
<p><strong>注意：下载不在同一主机上的私有仓库时，需要在docker的配置文件中添加 <em>–insecurity-registry</em> 参数。</strong></p>
<p>参考博客：<br><a href="https://segmentfault.com/a/1190000000801162" target="_blank" rel="external">https://segmentfault.com/a/1190000000801162</a><br><a href="http://cloud.51cto.com/art/201412/458680_all.htm" target="_blank" rel="external">http://cloud.51cto.com/art/201412/458680_all.htm</a></p>
</div></article></div></section><footer><div class="paginator"><a href="/2017/04/11/devicemapper设置direct-LVM踩坑记/" class="prev"><button class="ui button teal">PREV</button></a><a href="/2017/02/27/docker搭建elk镜像/" class="next"><button class="ui button teal">NEXT</button></a></div><div class="copyright"><p>© 2016 - 2017 <a href="http://yoursite.com">Rosy</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and theme by <a href="https://github.com/littlewin-wang/hexo-theme-casual" target="_blank">casual</a></p></div></footer></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script><script src="/js/jquery.goup.min.js"></script><script src="/js/semantic.min.js"></script><script src="/js/casual.js"></script><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>$(document).ready(function(){$.goup({trigger:100,bottomOffset:100,locationOffset:5,title:'',titleAsText:true});});</script><script>(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
_st('install','TvAnFS4AVxjiJUvrZJRB','2.0.0');</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></div></body></html>